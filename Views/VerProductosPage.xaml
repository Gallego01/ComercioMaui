<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ComercioMaui.Views.VerProductosPage"
             Title="Inventario de Productos">

    <VerticalStackLayout Spacing="15" Padding="20">

        <Label Text="Inventario Detallado" 
               FontSize="Large" 
               FontAttributes="Bold" 
               HorizontalOptions="Center" />
        <Picker x:Name="CategoriaPicker"
                Title="Seleccione una Categoría"
                ItemDisplayBinding="{Binding Nombre}"  
                SelectedIndexChanged="OnCategoriaFilterChanged" />
        <BoxView HeightRequest="1" Color="LightGray" Margin="0,10,0,10"/>

        <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
            <Switch x:Name="FavoritosSwitch" 
                    Toggled="OnFavoritosSwitchToggled"
                    VerticalOptions="Center"/>
            <Label Text="Mostrar solo favoritos" 
                   VerticalOptions="Center" 
                   FontSize="Small"/>
        </HorizontalStackLayout>
        <ScrollView>
            <VerticalStackLayout>

                <Grid Padding="10" BackgroundColor="#E0E0E0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="1.5*" />
                        <ColumnDefinition Width="1.5*" />
                        <ColumnDefinition Width="0.5*" />
                    </Grid.ColumnDefinitions>

                    <Label Grid.Column="0" Text="Producto" FontAttributes="Bold" FontSize="Small" HorizontalOptions="Center"/>
                    <Label Grid.Column="1" Text="Precio" FontAttributes="Bold" FontSize="Small" HorizontalOptions="Center"/>
                    <Label Grid.Column="2" Text="Stock" FontAttributes="Bold" FontSize="Small" HorizontalOptions="Center"/>
                    <Label Grid.Column="3" Text="Mínimo" FontAttributes="Bold" FontSize="Small" HorizontalOptions="Center"/>
                    <Label Grid.Column="4" Text="Creado" FontAttributes="Bold" FontSize="Micro" HorizontalOptions="Center"/>
                    <Label Grid.Column="5" Text="Modif." FontAttributes="Bold" FontSize="Micro" HorizontalOptions="Center"/>
                    <Label Grid.Column="6" Text="Fav" FontAttributes="Bold" FontSize="Micro" HorizontalOptions="Center"/>
                </Grid>

                <CollectionView x:Name="ProductosCollection" 
                                SelectionMode="Single"  RemainingItemsThreshold="1"
                                ItemsUpdatingScrollMode="KeepItemsInView">

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="10" ColumnSpacing="5" Margin="0, 0, 0, 5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="1*" />
                                    <ColumnDefinition Width="1*" />
                                    <ColumnDefinition Width="1*" />
                                    <ColumnDefinition Width="1*" />
                                    <ColumnDefinition Width="1.5*" />
                                    <ColumnDefinition Width="1.5*" />
                                    <ColumnDefinition Width="0.5*" />
                                </Grid.ColumnDefinitions>

                                <VerticalStackLayout Grid.Column="0">
                                    <Label Text="{Binding Nombre}" FontAttributes="Bold" FontSize="Micro" HorizontalOptions="Center"/>
                                </VerticalStackLayout>

                                <Label Grid.Column="1" Text="{Binding Precio, StringFormat='{0:C}'}" TextColor="Green" FontSize="Micro" HorizontalOptions="Center" VerticalOptions="Center"/>
                                <Label Grid.Column="2" Text="{Binding Stock}" FontSize="Micro" HorizontalOptions="Center" VerticalOptions="Center"/>
                                <Label Grid.Column="3" Text="{Binding StockMinimo}" FontSize="Micro" HorizontalOptions="Center" VerticalOptions="Center"/>

                                <Label Grid.Column="4" 
                                       Text="{Binding CreatedAt, StringFormat='{0:dd/MM/yy HH:mm}'}" 
                                       FontSize="Micro" 
                                       HorizontalOptions="Center" 
                                       VerticalOptions="Center"/>
                                <Label Grid.Column="5" 
                                       Text="{Binding UpdatedAt, StringFormat='{0:dd/MM/yy HH:mm}'}" 
                                       FontSize="Micro" 
                                       HorizontalOptions="Center" 
                                       VerticalOptions="Center"/>

                                <ImageButton Grid.Column="6"
                                             Clicked="OnToggleFavoritoClicked"
                                             VerticalOptions="Center"
                                             HorizontalOptions="Center"
                                             HeightRequest="20"
                                             WidthRequest="20">
                                    <ImageButton.Triggers>
                                        <DataTrigger TargetType="ImageButton"
                                                     Binding="{Binding IsFavorito}"
                                                     Value="True">
                                            <Setter Property="Source" Value="star_filled.png" />
                                        </DataTrigger>
                                        <DataTrigger TargetType="ImageButton"
                                                     Binding="{Binding IsFavorito}"
                                                     Value="False">
                                            <Setter Property="Source" Value="star_empty.png" />
                                        </DataTrigger>
                                    </ImageButton.Triggers>
                                </ImageButton>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>
        <HorizontalStackLayout x:Name="ProductosButtonsLayout" Spacing="10" HorizontalOptions="Center">
            <Button Text="Agregar Producto" Clicked="OnAgregarProductoClicked" />
            <Button Text="Editar Producto" Clicked="OnEditarProductoClicked" />
            <Button Text="Eliminar Producto" Clicked="OnEliminarProductoClicked" BackgroundColor="Red" TextColor="White"/>
        </HorizontalStackLayout>

        <Button Text="Exportar a CSV" 
                Clicked="OnExportarCsvClicked" 
                BackgroundColor="#007BFF" 
                TextColor="White"
                HorizontalOptions="Center"
                Margin="0, 10, 0, 0"/>
    </VerticalStackLayout>
</ContentPage>